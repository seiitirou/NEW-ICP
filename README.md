# NEW-ICP
絶対的基準馬から導き出した馬の地力と、今回の馬が、どれだけの実力を発揮できるかを予想の軸とした予想
📘 ICP × GMax 予測システム – 仕様書 v5.0
🔎 概要

目的：AIを用いた競馬予測システム

基本式：

予測スコア = 地力スコア × 出力率


最終出力：TARGET互換のCSV

各馬のICPスコア

損益分岐オッズ

🏇 地力スコア（Base Power）
コンセプト

馬の「絶対能力（MAXポテンシャル）」を数値化。
基準馬（G-Horse）＝100。

入力データ

レース日付・開催・コース（芝／ダート、距離、右左）

レースクラス（G1〜条件戦）

走破タイム

着差（馬身 → 秒換算）

斤量

ラップ（前後半／可能ならハロン毎）

通過順位

当日バイアス（逃げ／差し／内外／時計傾向）

計算手順

基準馬との差（タイム差算出）

着差補正（1馬身＝0.2秒換算）

斤量補正（0.5kg差＝0.2秒相当）

ペース補正（標準ラップとの差分補正）

当日バイアス補正（有利なら減点／不利なら加点）

レースレベル補正（クラス基準＋上位馬平均で収束）

時系列重み付け（新しいレースほど高い比重）

最終値算出（上位3走の加重平均 → G-Horse基準にスケーリング）

⚡ 出力率（Performance Output Rate）
コンセプト

「その日の発揮度合い」を表す。

要素

距離適性（±200mまで許容、それ以上は減点）

ラップ適性（脚質型とコース標準ラップの一致度）

馬場適性（統計補完）

未経験コースは「近似コースの好走率」で推定

例：東京1600m好走馬 → 阪神1800m・福島2000mでも高評価

A-index（競馬場適性指数）

内外回り・直線の長さ・坂の有無を考慮

展開補正（当日のバイアスと脚質の一致度）

XFER（交流補正）

地方→中央、海外→国内の水準差を調整

斤量補正（当日）

軽量 → 減点（恵まれ）

重量 → 加点（不利克服）

📊 勝率への変換

ソフトマックス正規化

𝑃
𝑖
=
𝑒
𝑠
𝑖
∑
𝑗
𝑒
𝑠
𝑗
P
i
	​

=
∑
j
	​

e
s
j
	​

e
s
i
	​

	​


キャリブレーション（JRA方式）

実測オッズと比較し、ロジスティック回帰で補正

💰 損益分岐オッズ

定義：

損益分岐オッズ = 1 / 勝率


例：勝率25% → 4.0倍

📂 出力仕様（TARGET互換）
出力ファイル
race_{日付}_{競馬場}{R番号}.csv
例: race_20250819_TOKYO11R.csv

CSV列構造
枠	馬番	馬名	ICPスコア	損益分岐オッズ

文字コード：Shift-JIS（TARGET対応のため）

📁 ディレクトリ構造
/runs/
  └── 20250819/
       ├── race_20250819_TOKYO11R.csv
       ├── race_20250819_TOKYO10R.csv
       ├── race_20250819_HAKODATE12R.csv
       └── day_20250819.csv   # 日次まとめ（任意）

🛠 開発フロー

データ取得（JRA-VAN, SaraD）

地力スコア算出（補正＋時系列）

出力率算出（距離・ラップ・A-index・馬場補完・斤量・XFER）

勝率化（Softmax＋Calibration）

損益分岐オッズ計算

TARGET互換CSV出力

🚀 拡張性

血統適性（父系・母父系ごとの傾向）

騎手・厩舎補正

休養明け補正（叩き2走目効果など）

機械学習によるパラメータ最適化

✅ まとめ

地力スコア = 馬の絶対能力

出力率 = 当日の発揮度合い

ICPスコア = 両者の積

損益分岐オッズ = 1 / 勝率

出力 = TARGET互換CSV（レースごと）
