
# NEW-ICP
çµ¶å¯¾çš„åŸºæº–é¦¬ã‹ã‚‰å°ãå‡ºã—ãŸé¦¬ã®åœ°åŠ›ã¨ã€ä»Šå›ã®é¦¬ãŒã€ã©ã‚Œã ã‘ã®å®ŸåŠ›ã‚’ç™ºæ®ã§ãã‚‹ã‹ã‚’äºˆæƒ³ã®è»¸ã¨ã—ãŸäºˆæƒ³
ğŸ“˜ ICP Ã— GMax äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ  â€“ ä»•æ§˜æ›¸ v5.0
ğŸ” æ¦‚è¦

ç›®çš„ï¼šAIã‚’ç”¨ã„ãŸç«¶é¦¬äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 

åŸºæœ¬å¼ï¼š

äºˆæ¸¬ã‚¹ã‚³ã‚¢ = åœ°åŠ›ã‚¹ã‚³ã‚¢ Ã— å‡ºåŠ›ç‡


æœ€çµ‚å‡ºåŠ›ï¼šTARGETäº’æ›ã®CSV

å„é¦¬ã®ICPã‚¹ã‚³ã‚¢

æç›Šåˆ†å²ã‚ªãƒƒã‚º

ğŸ‡ åœ°åŠ›ã‚¹ã‚³ã‚¢ï¼ˆBase Powerï¼‰
ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

é¦¬ã®ã€Œçµ¶å¯¾èƒ½åŠ›ï¼ˆMAXãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼‰ã€ã‚’æ•°å€¤åŒ–ã€‚
åŸºæº–é¦¬ï¼ˆG-Horseï¼‰ï¼100ã€‚

å…¥åŠ›ãƒ‡ãƒ¼ã‚¿

ãƒ¬ãƒ¼ã‚¹æ—¥ä»˜ãƒ»é–‹å‚¬ãƒ»ã‚³ãƒ¼ã‚¹ï¼ˆèŠï¼ãƒ€ãƒ¼ãƒˆã€è·é›¢ã€å³å·¦ï¼‰

ãƒ¬ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ï¼ˆG1ã€œæ¡ä»¶æˆ¦ï¼‰

èµ°ç ´ã‚¿ã‚¤ãƒ 

ç€å·®ï¼ˆé¦¬èº« â†’ ç§’æ›ç®—ï¼‰

æ–¤é‡

ãƒ©ãƒƒãƒ—ï¼ˆå‰å¾ŒåŠï¼å¯èƒ½ãªã‚‰ãƒãƒ­ãƒ³æ¯ï¼‰

é€šéé †ä½

å½“æ—¥ãƒã‚¤ã‚¢ã‚¹ï¼ˆé€ƒã’ï¼å·®ã—ï¼å†…å¤–ï¼æ™‚è¨ˆå‚¾å‘ï¼‰

è¨ˆç®—æ‰‹é †

åŸºæº–é¦¬ã¨ã®å·®ï¼ˆã‚¿ã‚¤ãƒ å·®ç®—å‡ºï¼‰

ç€å·®è£œæ­£ï¼ˆ1é¦¬èº«ï¼0.2ç§’æ›ç®—ï¼‰

æ–¤é‡è£œæ­£ï¼ˆ0.5kgå·®ï¼0.2ç§’ç›¸å½“ï¼‰

ãƒšãƒ¼ã‚¹è£œæ­£ï¼ˆæ¨™æº–ãƒ©ãƒƒãƒ—ã¨ã®å·®åˆ†è£œæ­£ï¼‰

å½“æ—¥ãƒã‚¤ã‚¢ã‚¹è£œæ­£ï¼ˆæœ‰åˆ©ãªã‚‰æ¸›ç‚¹ï¼ä¸åˆ©ãªã‚‰åŠ ç‚¹ï¼‰

ãƒ¬ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«è£œæ­£ï¼ˆã‚¯ãƒ©ã‚¹åŸºæº–ï¼‹ä¸Šä½é¦¬å¹³å‡ã§åæŸï¼‰

æ™‚ç³»åˆ—é‡ã¿ä»˜ã‘ï¼ˆæ–°ã—ã„ãƒ¬ãƒ¼ã‚¹ã»ã©é«˜ã„æ¯”é‡ï¼‰

æœ€çµ‚å€¤ç®—å‡ºï¼ˆä¸Šä½3èµ°ã®åŠ é‡å¹³å‡ â†’ G-HorseåŸºæº–ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰

âš¡ å‡ºåŠ›ç‡ï¼ˆPerformance Output Rateï¼‰
ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

ã€Œãã®æ—¥ã®ç™ºæ®åº¦åˆã„ã€ã‚’è¡¨ã™ã€‚

è¦ç´ 

è·é›¢é©æ€§ï¼ˆÂ±200mã¾ã§è¨±å®¹ã€ãã‚Œä»¥ä¸Šã¯æ¸›ç‚¹ï¼‰

ãƒ©ãƒƒãƒ—é©æ€§ï¼ˆè„šè³ªå‹ã¨ã‚³ãƒ¼ã‚¹æ¨™æº–ãƒ©ãƒƒãƒ—ã®ä¸€è‡´åº¦ï¼‰


æœªçµŒé¨“ã‚³ãƒ¼ã‚¹ã¯ã€Œè¿‘ä¼¼ã‚³ãƒ¼ã‚¹ã®å¥½èµ°ç‡ã€ã§æ¨å®š

ä¾‹ï¼šæ±äº¬1600må¥½èµ°é¦¬ â†’ é˜ªç¥1800mãƒ»ç¦å³¶2000mã§ã‚‚é«˜è©•ä¾¡

A-indexï¼ˆç«¶é¦¬å ´é©æ€§æŒ‡æ•°ï¼‰

å†…å¤–å›ã‚Šãƒ»ç›´ç·šã®é•·ã•ãƒ»å‚ã®æœ‰ç„¡ã‚’è€ƒæ…®

å±•é–‹è£œæ­£ï¼ˆå½“æ—¥ã®ãƒã‚¤ã‚¢ã‚¹ã¨è„šè³ªã®ä¸€è‡´åº¦ï¼‰

XFERï¼ˆäº¤æµè£œæ­£ï¼‰

åœ°æ–¹â†’ä¸­å¤®ã€æµ·å¤–â†’å›½å†…ã®æ°´æº–å·®ã‚’èª¿æ•´

æ–¤é‡è£œæ­£ï¼ˆå½“æ—¥ï¼‰

è»½é‡ â†’ æ¸›ç‚¹ï¼ˆæµã¾ã‚Œï¼‰

é‡é‡ â†’ åŠ ç‚¹ï¼ˆä¸åˆ©å…‹æœï¼‰

ğŸ“Š å‹ç‡ã¸ã®å¤‰æ›

ã‚½ãƒ•ãƒˆãƒãƒƒã‚¯ã‚¹æ­£è¦åŒ–

ğ‘ƒ
ğ‘–
=
ğ‘’
ğ‘ 
ğ‘–
âˆ‘
ğ‘—
ğ‘’
ğ‘ 
ğ‘—
P
i
	â€‹

=
âˆ‘
j
	â€‹

e
s
j
	â€‹

e
s
i
	â€‹

	â€‹


ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆJRAæ–¹å¼ï¼‰

å®Ÿæ¸¬ã‚ªãƒƒã‚ºã¨æ¯”è¼ƒã—ã€ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã§è£œæ­£

ğŸ’° æç›Šåˆ†å²ã‚ªãƒƒã‚º

å®šç¾©ï¼š

æç›Šåˆ†å²ã‚ªãƒƒã‚º = 1 / å‹ç‡


ä¾‹ï¼šå‹ç‡25% â†’ 4.0å€

ğŸ“‚ å‡ºåŠ›ä»•æ§˜ï¼ˆTARGETäº’æ›ï¼‰
å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
race_{æ—¥ä»˜}_{ç«¶é¦¬å ´}{Rç•ªå·}.csv
ä¾‹: race_20250819_TOKYO11R.csv

CSVåˆ—æ§‹é€ 
æ 	é¦¬ç•ª	é¦¬å	ICPã‚¹ã‚³ã‚¢	æç›Šåˆ†å²ã‚ªãƒƒã‚º

æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼šShift-JISï¼ˆTARGETå¯¾å¿œã®ãŸã‚ï¼‰

ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
/runs/
  â””â”€â”€ 20250819/
       â”œâ”€â”€ race_20250819_TOKYO11R.csv
       â”œâ”€â”€ race_20250819_TOKYO10R.csv
       â”œâ”€â”€ race_20250819_HAKODATE12R.csv
       â””â”€â”€ day_20250819.csv   # æ—¥æ¬¡ã¾ã¨ã‚ï¼ˆä»»æ„ï¼‰

ğŸ›  é–‹ç™ºãƒ•ãƒ­ãƒ¼

ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆJRA-VAN, SaraDï¼‰

åœ°åŠ›ã‚¹ã‚³ã‚¢ç®—å‡ºï¼ˆè£œæ­£ï¼‹æ™‚ç³»åˆ—ï¼‰

å‡ºåŠ›ç‡ç®—å‡ºï¼ˆè·é›¢ãƒ»ãƒ©ãƒƒãƒ—ãƒ»A-indexãƒ»é¦¬å ´è£œå®Œãƒ»æ–¤é‡ãƒ»XFERï¼‰

å‹ç‡åŒ–ï¼ˆSoftmaxï¼‹Calibrationï¼‰

æç›Šåˆ†å²ã‚ªãƒƒã‚ºè¨ˆç®—

TARGETäº’æ›CSVå‡ºåŠ›

ğŸš€ æ‹¡å¼µæ€§

è¡€çµ±é©æ€§ï¼ˆçˆ¶ç³»ãƒ»æ¯çˆ¶ç³»ã”ã¨ã®å‚¾å‘ï¼‰

é¨æ‰‹ãƒ»å©èˆè£œæ­£

ä¼‘é¤Šæ˜ã‘è£œæ­£ï¼ˆå©ã2èµ°ç›®åŠ¹æœãªã©ï¼‰

æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

âœ… ã¾ã¨ã‚

åœ°åŠ›ã‚¹ã‚³ã‚¢ = é¦¬ã®çµ¶å¯¾èƒ½åŠ›

å‡ºåŠ›ç‡ = å½“æ—¥ã®ç™ºæ®åº¦åˆã„

ICPã‚¹ã‚³ã‚¢ = ä¸¡è€…ã®ç©

æç›Šåˆ†å²ã‚ªãƒƒã‚º = 1 / å‹ç‡

å‡ºåŠ› = TARGETäº’æ›CSVï¼ˆãƒ¬ãƒ¼ã‚¹ã”ã¨ï¼‰

# ğŸ ICPÃ—GMax çµ±åˆç‰ˆ ç«¶é¦¬äºˆæ¸¬AI ä»•æ§˜æ›¸ï¼ˆè¶…è©³ç´°ç‰ˆï¼‰

---

## 1. åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

- æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ **ã€Œé¦¬ã®åœ°åŠ›ï¼ˆBasePowerï¼‰ Ã— å‡ºåŠ›ç‡ï¼ˆOutputRateï¼‰ã€** ã«ã‚ˆã£ã¦ã€ãƒ¬ãƒ¼ã‚¹å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ•°å€¤åŒ–ã™ã‚‹ã€‚  
- å‡ºåŠ›ã¯ **TARGETäº’æ›å½¢å¼** ã§è¡¨ç¤ºã—ã€ä»¥ä¸‹ã‚’å¿…ãšå‡ºåŠ›ã™ã‚‹ï¼š  
  - **ICPã‚¹ã‚³ã‚¢ï¼ˆæœ€çµ‚äºˆæ¸¬å€¤ï¼‰**  
  - **æç›Šåˆ†å²ã‚ªãƒƒã‚ºï¼ˆãã®é¦¬ã‚’è²·ãˆã‚‹æœ€ä½é™ã®ã‚ªãƒƒã‚ºãƒ©ã‚¤ãƒ³ï¼‰**  
- ãƒ‡ãƒ¼ã‚¿ã¯ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆ SARAD** ã‹ã‚‰å–å¾—ã—ã€å†…éƒ¨ã§å­¦ç¿’ãƒ»æ¨å®šå‡¦ç†ã‚’è¡Œã†ã€‚  

---

## 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

### 2.1 SARADã‹ã‚‰å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
- å‡ºèµ°é¦¬æƒ…å ±ï¼ˆé¦¬åãƒ»é¦¬ç•ªãƒ»çˆ¶æ¯ç³»çµ±ãƒ»å¹´é½¢ãƒ»æ€§åˆ¥ï¼‰  
- ãƒ¬ãƒ¼ã‚¹æƒ…å ±ï¼ˆé–‹å‚¬ãƒ»ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢ãƒ»é¦¬å ´çŠ¶æ…‹ãƒ»å¤©å€™ãƒ»RLSé–¢é€£æƒ…å ±ï¼‰  
- éå»æˆç¸¾ï¼ˆç€é †ã€ç€å·®ã€é€šéé †ã€ãƒ©ãƒƒãƒ—ã€ä¸ŠãŒã‚Š3Fã€å¯¾æˆ¦ç›¸æ‰‹ï¼‰  
- æ–¤é‡ã€é¨æ‰‹ã€èª¿æ•™å¸«ãªã©ä»˜å¸¯æƒ…å ±  

### 2.2 ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
- SARADã®ãƒ¬ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ ãƒ»ãƒ©ãƒƒãƒ—ã‚’æ¨™æº–åŒ–ï¼ˆè·é›¢ãƒ»ã‚³ãƒ¼ã‚¹å·®ã‚’å¸åï¼‰  
- RLSï¼ˆRace Level Scoreï¼‰ã¯ã€å‡ºèµ°é¦¬ã®éå»å®Ÿç¸¾ã¨ç…§åˆã—ã¦ç›¸å¯¾è©•ä¾¡  
- å„é¦¬ã®éå»èµ°ã”ã¨ã«ã€Œæ¨™æº–åŒ–ã‚¿ã‚¤ãƒ ï¼‹è£œæ­£å€¤ã€ã‚’è¨ˆç®—ã—ã¦å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åŒ–  

---

## 3. åœ°åŠ›ã‚¹ã‚³ã‚¢ï¼ˆBasePowerï¼‰

### 3.1 å®šç¾©
- æ¶ç©ºã® **çµ¶å¯¾åŸºæº–é¦¬ï¼ˆã©ã®æ¡ä»¶ã§ã‚‚å¸¸ã«100ç‚¹ï¼‰** ã‚’ç‰©å·®ã—ã«ç®—å‡ºã™ã‚‹ã€‚  
- ã€Œãã®é¦¬ãŒæŒã¤æœ€å¤§èƒ½åŠ›ã€ã‚’è¡¨ç¾ã€‚  

### 3.2 è¨ˆç®—å¼ï¼ˆrawå€¤ï¼‰
1. **å€‹åˆ¥ãƒ¬ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   \[
   P_{i,r} = æ¨™æº–åŒ–ã‚¿ã‚¤ãƒ _{i,r} - è£œæ­£ï¼ˆæ–¤é‡ãƒ»å±•é–‹ãƒ»ãƒ©ãƒƒãƒ—é©å¿œï¼‰
   \]

2. **æœ€å¤§èƒ½åŠ›æŠ½å‡º**
   \[
   BasePower_{i,raw} = \max_{r \in éå»ãƒ¬ãƒ¼ã‚¹} f(P_{i,r}, RLS_r)
   \]

- é«˜RLSãƒ¬ãƒ¼ã‚¹ã¯é‡ã¿ã‚’å¤§ããã™ã‚‹ï¼ˆå­¦ç¿’ã§æœ€é©åŒ–ï¼‰ã€‚  

### 3.3 è£œæ­£è¦ç´ 
- **æ–¤é‡è£œæ­£**ï¼š0.5kgå·® â‰ˆ Â±è£œæ­£ptï¼ˆå­¦ç¿’ã§ä¿‚æ•°æœ€é©åŒ–ï¼‰  
- **å±•é–‹è£œæ­£**ï¼šä½ç½®å–ã‚Šã‚„éšŠåˆ—é•·ã«ã‚ˆã‚‹å½±éŸ¿ã‚’åŠ ç‚¹/æ¸›ç‚¹  
- **ãƒ©ãƒƒãƒ—è£œæ­£**ï¼š  
  - å¾—æ„ãƒ©ãƒƒãƒ—ã‹ã‚‰é›¢ã‚Œã¦ã„ã¦å¥½èµ° â†’ ï¼‹è£œæ­£  
  - å¾—æ„ãƒ©ãƒƒãƒ—æ¡ä»¶ã§å‡¡èµ° â†’ âˆ’è£œæ­£  
  - è£œæ­£é‡ã¯ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã§å­¦ç¿’  

### 3.4 ãƒ©ãƒƒãƒ—é©å¿œåŠ›ã®å°å…¥
- è£œæ­£çµæœã‹ã‚‰ã€Œãƒ©ãƒƒãƒ—ã‚ºãƒ¬ã«å¯¾ã™ã‚‹é©å¿œåŠ›ã€ã‚’å­¦ç¿’  
- é©å¿œåŠ›ãŒé«˜ã„é¦¬ã¯ã€å¹…åºƒã„å±•é–‹ã§ã‚‚åœ°åŠ›ã‚¹ã‚³ã‚¢ãŒå®‰å®š  
- é©å¿œåŠ›ãŒä½ã„é¦¬ã¯ã€ç†æƒ³æ¡ä»¶ã‚’å¤–ã‚Œã‚‹ã¨åœ°åŠ›ã‚¹ã‚³ã‚¢ãŒæ¸›è¡°  

### 3.5 åŸºæº–åŒ–å‡¦ç†
- **rawå€¤**ï¼ˆå†…éƒ¨å€¤ï¼‰ã¯100ç‚¹ã‚’è¶…ãˆã‚‹å ´åˆã‚‚ãã®ã¾ã¾ä¿å­˜  
- **å…¬é–‹å€¤**ã¯å¿…ãš100ç‚¹ä»¥ä¸‹ã«åã‚ã‚‹  

å‡¦ç†æ‰‹é †ï¼š  
1. ãƒ¬ãƒ¼ã‚¹å†…ã¾ãŸã¯æœŸé–“å†…ã§æœ€å¤§å€¤ M ã‚’æ±‚ã‚ã‚‹  
2. M > 100 ã®å ´åˆã€å…¨é¦¬ã‚’ä»¥ä¸‹ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼š  
   \[
   BasePower_{i,out} = BasePower_{i,raw} \times \frac{100}{M}
   \]  
3. å…¬é–‹ç”¨ã¯ outå€¤ã€å­¦ç¿’ç”¨ã¯ rawå€¤ã‚’ä½¿ç”¨  

---

## 4. å‡ºåŠ›ç‡ï¼ˆOutputRateï¼‰

### 4.1 å®šç¾©
- å½“æ—¥ã®ã€Œã©ã‚Œãã‚‰ã„åœ°åŠ›ã‚’ç™ºæ®ã§ãã‚‹ã‹ã€ã‚’è¡¨ã™ä¿‚æ•°  
- 0ã€œ1ã®ç¯„å›²ã‚’æŒ‡æ•°å¤‰æ›ã—ã¦ã‚¹ã‚³ã‚¢åŒ–  

\[
OutputRate_i = \exp(\Delta o_{course,i}+\Delta o_{form,i}+\Delta o_{bias,i}+\Delta o_{pace,i})
\]

### 4.2 å„è£œæ­£é …ç›®

1. **ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢é©æ€§è£œæ­£ï¼ˆÎ”o_courseï¼‰**  
   - é¦¬ã”ã¨ã«ã€Œå¾—æ„ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢ã€ã‚’å­¦ç¿’  
   - åˆå‡ºèµ°ã¯é¡ä¼¼æ¡ä»¶ï¼‹çµ±è¨ˆã§è£œå®Œ  

2. **è¿‘èµ°ãƒ•ã‚©ãƒ¼ãƒ è£œæ­£ï¼ˆÎ”o_formï¼‰**  
   - ç›´è¿‘ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‚¾å‘ã‚’æŒ‡æ•°åŒ–  
   - é€£ç¶šå¥½èµ° â†’ ï¼‹è£œæ­£ã€å‡¡èµ°ç¶šã â†’ âˆ’è£œæ­£  

3. **å½“æ—¥ãƒã‚¤ã‚¢ã‚¹è£œæ­£ï¼ˆÎ”o_biasï¼‰**  
   - è„šè³ªæœ‰åˆ©ãƒ»é¦¬å ´å‚¾å‘ã‚’çµ±è¨ˆçš„ã«æ¤œå‡º  
   - è„šè³ªãƒ»é¦¬å ´ç‰¹æ€§ã¨ãƒãƒƒãƒã™ã‚Œã°ï¼‹è£œæ­£  

4. **å±•é–‹è£œæ­£ï¼ˆÎ”o_paceï¼‰**  
   - å„é¦¬ã®ç†æƒ³ãƒ©ãƒƒãƒ—ã‚’ã€Œé«˜RLSå‹åˆ©æ™‚ãƒ©ãƒƒãƒ—ã€ã‹ã‚‰åˆæœŸåŒ–  
   - å­¦ç¿’ã§ latent vector ã¨ã—ã¦æ´—ç·´  
   - å½“æ—¥ã®äºˆæ¸¬ãƒ©ãƒƒãƒ—ã¨ã®å·®åˆ†ã«å¿œã˜ã¦è£œæ­£  
   - ã‚ºãƒ¬è€æ€§ï¼ˆÏƒï¼‰ã¯é¦¬ã”ã¨ã«å­¦ç¿’  

---

## 5. æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼ˆICPã‚¹ã‚³ã‚¢ï¼‰

\[
ICPScore_i = BasePower_{i,out} \times OutputRate_i
\]

---

## 6. æç›Šåˆ†å²ã‚ªãƒƒã‚ºï¼ˆBreak-even Oddsï¼‰

1. å‹ç‡è¨ˆç®—ï¼ˆã‚½ãƒ•ãƒˆãƒãƒƒã‚¯ã‚¹ï¼‰  
\[
WinProb_i = \frac{e^{ICPScore_i}}{\sum_j e^{ICPScore_j}}
\]

2. æç›Šåˆ†å²ç‚¹ï¼ˆ100%å›åãƒ©ã‚¤ãƒ³ï¼‰  
\[
BreakEvenOdds_i = \frac{1}{WinProb_i}
\]

---

## 7. å­¦ç¿’ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰

1. **å…¥åŠ›ç‰¹å¾´é‡**
   - ãƒ¬ãƒ¼ã‚¹æƒ…å ±ï¼ˆã‚³ãƒ¼ã‚¹ã€è·é›¢ã€å¤©å€™ã€RLSï¼‰  
   - é¦¬æƒ…å ±ï¼ˆéå»ãƒ©ãƒƒãƒ—ç³»åˆ—ã€åœ°åŠ›å±¥æ­´ã€è„šè³ªï¼‰  
   - å½“æ—¥äºˆæ¸¬ï¼ˆæƒ³å®šãƒ©ãƒƒãƒ—ã€ã‚ªãƒƒã‚ºï¼‰  

2. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**
   - BasePower Headï¼šæœ€å¤§èƒ½åŠ›æŠ½å‡º  
   - OutputRate Headï¼šè£œæ­£çµ±åˆ  
   - LapHeadï¼šå½“æ—¥ãƒ©ãƒƒãƒ—äºˆæ¸¬  
   - IdealLap Encoderï¼šç†æƒ³ãƒ©ãƒƒãƒ—æ½œåœ¨è¡¨ç¾ã®å­¦ç¿’  

3. **æå¤±é–¢æ•°**
   - äºˆæ¸¬å‹ç‡ vs å®Ÿçµæœï¼ˆäº¤å·®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼‰  
   - äºˆæ¸¬ãƒ©ãƒƒãƒ— vs å®Ÿãƒ©ãƒƒãƒ—ï¼ˆHuberæå¤±ï¼‰  
   - åŠ é‡å’Œã§æœ€é©åŒ–  

4. **æœ€é©åŒ–**
   - AdamW + å‹¾é…ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°  

---

## 8. å‡ºåŠ›å½¢å¼ï¼ˆTARGETäº’æ›ï¼‰

- å‡ºåŠ›ã¯ **ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼**ï¼ˆTARGETã«å–ã‚Šè¾¼ã‚ã‚‹å½¢ï¼‰ã€‚  
- é …ç›®ï¼šé¦¬ç•ªãƒ»é¦¬åãƒ»ICPã‚¹ã‚³ã‚¢ãƒ»æç›Šåˆ†å²ã‚ªãƒƒã‚ºã€‚  

ä¾‹ï¼š

```
é¦¬ç•ª  é¦¬å            ICPã‚¹ã‚³ã‚¢    æç›Šåˆ†å²ã‚ªãƒƒã‚º
 1   ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹     112.3        3.5
 2   ãƒ†ã‚¹ãƒˆãƒ›ãƒ¼ã‚¹       105.7        5.8
```

---

## 9. å®Ÿè£…ãƒ¡ãƒ¢ï¼ˆPythonä¾‹ï¼‰

```python
# BasePoweræ­£è¦åŒ–
raw_scores = [108.2, 97.5, 85.3]
M = max(raw_scores)
if M > 100:
    base_power_out = [s * 100 / M for s in raw_scores]
else:
    base_power_out = raw_scores

# OutputRateã¨ã®çµ±åˆ
scores = [bp * orate for bp, orate in zip(base_power_out, output_rates)]

# å‹ç‡ã¨æç›Šåˆ†å²ç‚¹
exp_scores = [math.exp(s) for s in scores]
win_probs = [es / sum(exp_scores) for es in exp_scores]
breakeven_odds = [1/p for p in win_probs]

# TARGETå½¢å¼å‡ºåŠ›
for num, name, sc, odds in zip(numbers, names, scores, breakeven_odds):
    print(f"{num:2d}  {name:12s}  {sc:.1f}   {odds:.1f}")
```

---

## 10. ä»Šå¾Œã®æ‹¡å¼µ
- ä»–åˆ¸ç¨®ï¼ˆè¤‡å‹ãƒ»é¦¬é€£ãƒ»ä¸‰é€£ç³»ï¼‰ã¸ã®å¯¾å¿œ  
- å¼·åŒ–å­¦ç¿’ã«ã‚ˆã‚‹ã€Œå›åç‡æœ€å¤§åŒ–ã€å­¦ç¿’  
- èª¿æ•™æ™‚è¨ˆãƒ»é¦¬ä½“é‡ãƒ»å¤–å©æƒ…å ±ãªã©è¿½åŠ å› å­ã®
# ğŸ ICPÃ—GMax çµ±åˆç‰ˆ ç«¶é¦¬äºˆæ¸¬AI ä»•æ§˜æ›¸ï¼ˆè¶…è©³ç´°ç‰ˆï¼‰

---

## 1. åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

- æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ **ã€Œé¦¬ã®åœ°åŠ›ï¼ˆBasePowerï¼‰ Ã— å‡ºåŠ›ç‡ï¼ˆOutputRateï¼‰ã€** ã«ã‚ˆã£ã¦ã€ãƒ¬ãƒ¼ã‚¹å½“æ—¥ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ•°å€¤åŒ–ã™ã‚‹ã€‚  
- å‡ºåŠ›ã¯ **TARGETäº’æ›å½¢å¼** ã§è¡¨ç¤ºã—ã€ä»¥ä¸‹ã‚’å¿…ãšå‡ºåŠ›ã™ã‚‹ï¼š  
  - **ICPã‚¹ã‚³ã‚¢ï¼ˆæœ€çµ‚äºˆæ¸¬å€¤ï¼‰**  
  - **æç›Šåˆ†å²ã‚ªãƒƒã‚ºï¼ˆãã®é¦¬ã‚’è²·ãˆã‚‹æœ€ä½é™ã®ã‚ªãƒƒã‚ºãƒ©ã‚¤ãƒ³ï¼‰**  
- ãƒ‡ãƒ¼ã‚¿ã¯ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆ SARAD** ã‹ã‚‰å–å¾—ã—ã€å†…éƒ¨ã§å­¦ç¿’ãƒ»æ¨å®šå‡¦ç†ã‚’è¡Œã†ã€‚  

---

## 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

### 2.1 SARADã‹ã‚‰å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
- å‡ºèµ°é¦¬æƒ…å ±ï¼ˆé¦¬åãƒ»é¦¬ç•ªãƒ»çˆ¶æ¯ç³»çµ±ãƒ»å¹´é½¢ãƒ»æ€§åˆ¥ï¼‰  
- ãƒ¬ãƒ¼ã‚¹æƒ…å ±ï¼ˆé–‹å‚¬ãƒ»ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢ãƒ»é¦¬å ´çŠ¶æ…‹ãƒ»å¤©å€™ãƒ»RLSé–¢é€£æƒ…å ±ï¼‰  
- éå»æˆç¸¾ï¼ˆç€é †ã€ç€å·®ã€é€šéé †ã€ãƒ©ãƒƒãƒ—ã€ä¸ŠãŒã‚Š3Fã€å¯¾æˆ¦ç›¸æ‰‹ï¼‰  
- æ–¤é‡ã€é¨æ‰‹ã€èª¿æ•™å¸«ãªã©ä»˜å¸¯æƒ…å ±  

### 2.2 ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
- SARADã®ãƒ¬ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ ãƒ»ãƒ©ãƒƒãƒ—ã‚’æ¨™æº–åŒ–ï¼ˆè·é›¢ãƒ»ã‚³ãƒ¼ã‚¹å·®ã‚’å¸åï¼‰  
- RLSï¼ˆRace Level Scoreï¼‰ã¯ã€å‡ºèµ°é¦¬ã®éå»å®Ÿç¸¾ã¨ç…§åˆã—ã¦ç›¸å¯¾è©•ä¾¡  
- å„é¦¬ã®éå»èµ°ã”ã¨ã«ã€Œæ¨™æº–åŒ–ã‚¿ã‚¤ãƒ ï¼‹è£œæ­£å€¤ã€ã‚’è¨ˆç®—ã—ã¦å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åŒ–  

---

## 3. åœ°åŠ›ã‚¹ã‚³ã‚¢ï¼ˆBasePowerï¼‰

### 3.1 å®šç¾©
- æ¶ç©ºã® **çµ¶å¯¾åŸºæº–é¦¬ï¼ˆã©ã®æ¡ä»¶ã§ã‚‚å¸¸ã«100ç‚¹ï¼‰** ã‚’ç‰©å·®ã—ã«ç®—å‡ºã™ã‚‹ã€‚  
- ã€Œãã®é¦¬ãŒæŒã¤æœ€å¤§èƒ½åŠ›ã€ã‚’è¡¨ç¾ã€‚  

### 3.2 è¨ˆç®—å¼ï¼ˆrawå€¤ï¼‰
1. **å€‹åˆ¥ãƒ¬ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   \[
   P_{i,r} = æ¨™æº–åŒ–ã‚¿ã‚¤ãƒ _{i,r} - è£œæ­£ï¼ˆæ–¤é‡ãƒ»å±•é–‹ãƒ»ãƒ©ãƒƒãƒ—é©å¿œï¼‰
   \]

2. **æœ€å¤§èƒ½åŠ›æŠ½å‡º**
   \[
   BasePower_{i,raw} = \max_{r \in éå»ãƒ¬ãƒ¼ã‚¹} f(P_{i,r}, RLS_r)
   \]

- é«˜RLSãƒ¬ãƒ¼ã‚¹ã¯é‡ã¿ã‚’å¤§ããã™ã‚‹ï¼ˆå­¦ç¿’ã§æœ€é©åŒ–ï¼‰ã€‚  

### 3.3 è£œæ­£è¦ç´ 
- **æ–¤é‡è£œæ­£**ï¼š0.5kgå·® â‰ˆ Â±è£œæ­£ptï¼ˆå­¦ç¿’ã§ä¿‚æ•°æœ€é©åŒ–ï¼‰  
- **å±•é–‹è£œæ­£**ï¼šä½ç½®å–ã‚Šã‚„éšŠåˆ—é•·ã«ã‚ˆã‚‹å½±éŸ¿ã‚’åŠ ç‚¹/æ¸›ç‚¹  
- **ãƒ©ãƒƒãƒ—è£œæ­£**ï¼š  
  - å¾—æ„ãƒ©ãƒƒãƒ—ã‹ã‚‰é›¢ã‚Œã¦ã„ã¦å¥½èµ° â†’ ï¼‹è£œæ­£  
  - å¾—æ„ãƒ©ãƒƒãƒ—æ¡ä»¶ã§å‡¡èµ° â†’ âˆ’è£œæ­£  
  - è£œæ­£é‡ã¯ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã§å­¦ç¿’  

### 3.4 ãƒ©ãƒƒãƒ—é©å¿œåŠ›ã®å°å…¥
- è£œæ­£çµæœã‹ã‚‰ã€Œãƒ©ãƒƒãƒ—ã‚ºãƒ¬ã«å¯¾ã™ã‚‹é©å¿œåŠ›ã€ã‚’å­¦ç¿’  
- é©å¿œåŠ›ãŒé«˜ã„é¦¬ã¯ã€å¹…åºƒã„å±•é–‹ã§ã‚‚åœ°åŠ›ã‚¹ã‚³ã‚¢ãŒå®‰å®š  
- é©å¿œåŠ›ãŒä½ã„é¦¬ã¯ã€ç†æƒ³æ¡ä»¶ã‚’å¤–ã‚Œã‚‹ã¨åœ°åŠ›ã‚¹ã‚³ã‚¢ãŒæ¸›è¡°  

### 3.5 åŸºæº–åŒ–å‡¦ç†
- **rawå€¤**ï¼ˆå†…éƒ¨å€¤ï¼‰ã¯100ç‚¹ã‚’è¶…ãˆã‚‹å ´åˆã‚‚ãã®ã¾ã¾ä¿å­˜  
- **å…¬é–‹å€¤**ã¯å¿…ãš100ç‚¹ä»¥ä¸‹ã«åã‚ã‚‹  

å‡¦ç†æ‰‹é †ï¼š  
1. ãƒ¬ãƒ¼ã‚¹å†…ã¾ãŸã¯æœŸé–“å†…ã§æœ€å¤§å€¤ M ã‚’æ±‚ã‚ã‚‹  
2. M > 100 ã®å ´åˆã€å…¨é¦¬ã‚’ä»¥ä¸‹ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼š  
   \[
   BasePower_{i,out} = BasePower_{i,raw} \times \frac{100}{M}
   \]  
3. å…¬é–‹ç”¨ã¯ outå€¤ã€å­¦ç¿’ç”¨ã¯ rawå€¤ã‚’ä½¿ç”¨  

---

## 4. å‡ºåŠ›ç‡ï¼ˆOutputRateï¼‰

### 4.1 å®šç¾©
- å½“æ—¥ã®ã€Œã©ã‚Œãã‚‰ã„åœ°åŠ›ã‚’ç™ºæ®ã§ãã‚‹ã‹ã€ã‚’è¡¨ã™ä¿‚æ•°  
- 0ã€œ1ã®ç¯„å›²ã‚’æŒ‡æ•°å¤‰æ›ã—ã¦ã‚¹ã‚³ã‚¢åŒ–  

\[
OutputRate_i = \exp(\Delta o_{course,i}+\Delta o_{form,i}+\Delta o_{bias,i}+\Delta o_{pace,i})
\]

### 4.2 å„è£œæ­£é …ç›®

1. **ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢é©æ€§è£œæ­£ï¼ˆÎ”o_courseï¼‰**  
   - é¦¬ã”ã¨ã«ã€Œå¾—æ„ã‚³ãƒ¼ã‚¹ãƒ»è·é›¢ã€ã‚’å­¦ç¿’  
   - åˆå‡ºèµ°ã¯é¡ä¼¼æ¡ä»¶ï¼‹çµ±è¨ˆã§è£œå®Œ  

2. **è¿‘èµ°ãƒ•ã‚©ãƒ¼ãƒ è£œæ­£ï¼ˆÎ”o_formï¼‰**  
   - ç›´è¿‘ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‚¾å‘ã‚’æŒ‡æ•°åŒ–  
   - é€£ç¶šå¥½èµ° â†’ ï¼‹è£œæ­£ã€å‡¡èµ°ç¶šã â†’ âˆ’è£œæ­£  

3. **å½“æ—¥ãƒã‚¤ã‚¢ã‚¹è£œæ­£ï¼ˆÎ”o_biasï¼‰**  
   - è„šè³ªæœ‰åˆ©ãƒ»é¦¬å ´å‚¾å‘ã‚’çµ±è¨ˆçš„ã«æ¤œå‡º  
   - è„šè³ªãƒ»é¦¬å ´ç‰¹æ€§ã¨ãƒãƒƒãƒã™ã‚Œã°ï¼‹è£œæ­£  

4. **å±•é–‹è£œæ­£ï¼ˆÎ”o_paceï¼‰**  
   - å„é¦¬ã®ç†æƒ³ãƒ©ãƒƒãƒ—ã‚’ã€Œé«˜RLSå‹åˆ©æ™‚ãƒ©ãƒƒãƒ—ã€ã‹ã‚‰åˆæœŸåŒ–  
   - å­¦ç¿’ã§ latent vector ã¨ã—ã¦æ´—ç·´  
   - å½“æ—¥ã®äºˆæ¸¬ãƒ©ãƒƒãƒ—ã¨ã®å·®åˆ†ã«å¿œã˜ã¦è£œæ­£  
   - ã‚ºãƒ¬è€æ€§ï¼ˆÏƒï¼‰ã¯é¦¬ã”ã¨ã«å­¦ç¿’  

---

## 5. æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼ˆICPã‚¹ã‚³ã‚¢ï¼‰

\[
ICPScore_i = BasePower_{i,out} \times OutputRate_i
\]

---

## 6. æç›Šåˆ†å²ã‚ªãƒƒã‚ºï¼ˆBreak-even Oddsï¼‰

1. å‹ç‡è¨ˆç®—ï¼ˆã‚½ãƒ•ãƒˆãƒãƒƒã‚¯ã‚¹ï¼‰  
\[
WinProb_i = \frac{e^{ICPScore_i}}{\sum_j e^{ICPScore_j}}
\]

2. æç›Šåˆ†å²ç‚¹ï¼ˆ100%å›åãƒ©ã‚¤ãƒ³ï¼‰  
\[
BreakEvenOdds_i = \frac{1}{WinProb_i}
\]

---

## 7. å­¦ç¿’ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰

1. **å…¥åŠ›ç‰¹å¾´é‡**
   - ãƒ¬ãƒ¼ã‚¹æƒ…å ±ï¼ˆã‚³ãƒ¼ã‚¹ã€è·é›¢ã€å¤©å€™ã€RLSï¼‰  
   - é¦¬æƒ…å ±ï¼ˆéå»ãƒ©ãƒƒãƒ—ç³»åˆ—ã€åœ°åŠ›å±¥æ­´ã€è„šè³ªï¼‰  
   - å½“æ—¥äºˆæ¸¬ï¼ˆæƒ³å®šãƒ©ãƒƒãƒ—ã€ã‚ªãƒƒã‚ºï¼‰  

2. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**
   - BasePower Headï¼šæœ€å¤§èƒ½åŠ›æŠ½å‡º  
   - OutputRate Headï¼šè£œæ­£çµ±åˆ  
   - LapHeadï¼šå½“æ—¥ãƒ©ãƒƒãƒ—äºˆæ¸¬  
   - IdealLap Encoderï¼šç†æƒ³ãƒ©ãƒƒãƒ—æ½œåœ¨è¡¨ç¾ã®å­¦ç¿’  

3. **æå¤±é–¢æ•°**
   - äºˆæ¸¬å‹ç‡ vs å®Ÿçµæœï¼ˆäº¤å·®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼‰  
   - äºˆæ¸¬ãƒ©ãƒƒãƒ— vs å®Ÿãƒ©ãƒƒãƒ—ï¼ˆHuberæå¤±ï¼‰  
   - åŠ é‡å’Œã§æœ€é©åŒ–  

4. **æœ€é©åŒ–**
   - AdamW + å‹¾é…ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°  

---

## 8. å‡ºåŠ›å½¢å¼ï¼ˆTARGETäº’æ›ï¼‰

- å‡ºåŠ›ã¯ **ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼**ï¼ˆTARGETã«å–ã‚Šè¾¼ã‚ã‚‹å½¢ï¼‰ã€‚  
- é …ç›®ï¼šé¦¬ç•ªãƒ»é¦¬åãƒ»ICPã‚¹ã‚³ã‚¢ãƒ»æç›Šåˆ†å²ã‚ªãƒƒã‚ºã€‚  

ä¾‹ï¼š

```
é¦¬ç•ª  é¦¬å            ICPã‚¹ã‚³ã‚¢    æç›Šåˆ†å²ã‚ªãƒƒã‚º
 1   ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹     112.3        3.5
 2   ãƒ†ã‚¹ãƒˆãƒ›ãƒ¼ã‚¹       105.7        5.8
```

---

## 9. å®Ÿè£…ãƒ¡ãƒ¢ï¼ˆPythonä¾‹ï¼‰

```python
# BasePoweræ­£è¦åŒ–
raw_scores = [108.2, 97.5, 85.3]
M = max(raw_scores)
if M > 100:
    base_power_out = [s * 100 / M for s in raw_scores]
else:
    base_power_out = raw_scores

# OutputRateã¨ã®çµ±åˆ
scores = [bp * orate for bp, orate in zip(base_power_out, output_rates)]

# å‹ç‡ã¨æç›Šåˆ†å²ç‚¹
exp_scores = [math.exp(s) for s in scores]
win_probs = [es / sum(exp_scores) for es in exp_scores]
breakeven_odds = [1/p for p in win_probs]

# TARGETå½¢å¼å‡ºåŠ›
for num, name, sc, odds in zip(numbers, names, scores, breakeven_odds):
    print(f"{num:2d}  {name:12s}  {sc:.1f}   {odds:.1f}")
```

---

## 10. ä»Šå¾Œã®æ‹¡å¼µ
- ä»–åˆ¸ç¨®ï¼ˆè¤‡å‹ãƒ»é¦¬é€£ãƒ»ä¸‰é€£ç³»ï¼‰ã¸ã®å¯¾å¿œ  
- å¼·åŒ–å­¦ç¿’ã«ã‚ˆã‚‹ã€Œå›åç‡æœ€å¤§åŒ–ã€å­¦ç¿’  
- èª¿æ•™æ™‚è¨ˆãƒ»é¦¬ä½“é‡ãƒ»å¤–å©æƒ…å ±ãªã©è¿½åŠ å› å­ã®å°å…¥  

# ğŸ ICP Ã— GMax â€“ æ¬¡ä¸–ä»£ç«¶é¦¬äºˆæ¸¬AI
**ICP Ã— GMax** ã¯ã€ç«¶èµ°é¦¬ã®ã€Œåœ°åŠ›ï¼ˆçµ¶å¯¾èƒ½åŠ›ï¼‰ã€ã¨ã€Œå½“æ—¥ã®ç™ºæ®åº¦ï¼ˆå‡ºåŠ›ç‡ï¼‰ã€ã‚’æ•°å€¤åŒ–ã—ã€  
TARGETäº’æ›ã®äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹ç«¶é¦¬äºˆæ¸¬ã‚¢ãƒ—ãƒªã§ã™ã€‚  

---

## ğŸ¯ ç›®çš„
- é¦¬ã® **æœ€å¤§èƒ½åŠ›ï¼ˆåœ°åŠ›ã‚¹ã‚³ã‚¢ï¼‰** ã¨ **å½“æ—¥ç™ºæ®åº¦ï¼ˆå‡ºåŠ›ç‡ï¼‰** ã‚’æ›ã‘åˆã‚ã›ã¦ã€äºˆæ¸¬ã‚¹ã‚³ã‚¢ã‚’ç®—å‡ºã€‚  
- **å‹ç‡ãƒ»æç›Šåˆ†å²ã‚ªãƒƒã‚º** ã‚’å‡ºåŠ›ã—ã€ã€Œè²·ãˆã‚‹é¦¬ã€ã€Œè²·ãˆãªã„é¦¬ã€ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚  
- å‡ºåŠ›ã¯ **TARGETäº’æ›CSV** å½¢å¼ã€‚

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ï¼ˆSARADã‹ã‚‰å–å¾—ï¼‰
- é¦¬æƒ…å ±ï¼šé¦¬åãƒ»é¦¬ç•ªãƒ»æ€§é½¢ãƒ»è¡€çµ±
- ãƒ¬ãƒ¼ã‚¹æ¡ä»¶ï¼šé–‹å‚¬å ´ãƒ»è·é›¢ãƒ»ã‚³ãƒ¼ã‚¹å½¢æ…‹ãƒ»é¦¬å ´çŠ¶æ…‹
- éå»æˆç¸¾ï¼šã‚¿ã‚¤ãƒ ãƒ»ç€å·®ãƒ»ãƒ©ãƒƒãƒ—ï¼ˆ200mã”ã¨ï¼‰ãƒ»é€šéé †ä½ãƒ»ä¸ŠãŒã‚Š
- é¨æ‰‹ãƒ»æ–¤é‡ãƒ»å©èˆæƒ…å ±

---

## ğŸ‡ ãƒ¬ãƒ¼ã‚¹åŒºé–“åˆ†æï¼ˆEãƒ»Mãƒ»Lï¼‰
ãƒ¬ãƒ¼ã‚¹ã‚’3åŒºé–“ã«åˆ†å‰²ã—ã¦200må˜ä½ã§ãƒ©ãƒƒãƒ—ã‚’åˆ†æã€‚

- **Eï¼ˆEarlyï¼‰**ï¼šã‚¹ã‚¿ãƒ¼ãƒˆã€œ1è§’  
  - ã‚¹ã‚¿ãƒ¼ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒ»ä½ç½®å–ã‚Šãƒ»å…ˆè¡ŒåŠ›
- **Mï¼ˆMiddleï¼‰**ï¼šä¸­é–“  
  - ãƒšãƒ¼ã‚¹æŒç¶šåŠ›ãƒ»ä¸­ã ã‚‹ã¿é©æ€§
- **Lï¼ˆLateï¼‰**ï¼š3-4è§’ã€œã‚´ãƒ¼ãƒ«  
  - æœ«è„šãƒ»å‚é©æ€§ãƒ»å·®ã—/è¿½ã„è¾¼ã¿åŠ›

ä¾‹ï¼ˆæ±äº¬1600mï¼‰ï¼š200m Ã— 8æœ¬ãƒ©ãƒƒãƒ—ã‚’ E/M/L ã«é›†ç´„ã—ã€åŒºé–“ã”ã¨ã«è©•ä¾¡ã€‚

---

## âš¡ åœ°åŠ›ã‚¹ã‚³ã‚¢ï¼ˆBase Powerï¼‰

### å®šç¾©
ã€Œãã®é¦¬ãŒæœ¬æ¥æŒã£ã¦ã„ã‚‹æœ€å¤§èƒ½åŠ›ã€  
åŸºæº–é¦¬ï¼ˆG-Horseï¼‰ï¼100

### è¨ˆç®—æ‰‹é †
1. æ¨™æº–åŒ–ã‚¿ã‚¤ãƒ ã‚’ä½œæˆ  
   - ç€å·®è£œæ­£ï¼ˆ1é¦¬èº«ï¼0.2ç§’æ›ç®—ï¼‰  
   - æ–¤é‡è£œæ­£ï¼ˆ0.5kgï¼0.2ç§’ï¼‰  
   - ãƒšãƒ¼ã‚¹è£œæ­£ï¼ˆæ¨™æº–ãƒ©ãƒƒãƒ—ã¨ã®å·®ï¼‰

2. åŒºé–“ã”ã¨ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç®—å‡º  
   \[
   P_E = \text{æ¨™æº–Eãƒ©ãƒƒãƒ—} - \text{å®ŸEãƒ©ãƒƒãƒ—}
   \]

3. åŒºé–“çµ±åˆ  
   \[
   BasePower = w_E \cdot P_E + w_M \cdot P_M + w_L \cdot P_L
   \]

4. åŸºæº–åŒ–ï¼ˆæœ€å¤§å€¤ã‚’100ã«æƒãˆã‚‹ï¼‰

---

## ğŸ”¥ å‡ºåŠ›ç‡ï¼ˆOutput Rateï¼‰

### å®šç¾©
ã€Œå½“æ—¥ã©ã®ãã‚‰ã„èµ°ã‚Œã‚‹ã‹ï¼ˆ0ã€œ1ï¼‰ã€

### è¨ˆç®—å¼
\[
OutputRate = \exp(\Delta o_{course} + \Delta o_{form} + \Delta o_{bias} + \Delta o_{pace})
\]

### è£œæ­£é …ç›®
- **Î”o_course**ï¼šã‚³ãƒ¼ã‚¹é©æ€§ï¼ˆå³å›ã‚Š/å·¦å›ã‚Šãƒ»è·é›¢ï¼‰
- **Î”o_form**ï¼šè¿‘èµ°èª¿å­ï¼ˆå¥½èµ°ç¶šãï¼ï¼‹ã€å‡¡èµ°ç¶šãï¼âˆ’ï¼‰
- **Î”o_bias**ï¼šå½“æ—¥é¦¬å ´å‚¾å‘ï¼ˆå‰æ®‹ã‚Šãƒ»å·®ã—æœ‰åˆ©ï¼‰
- **Î”o_pace**ï¼šE/M/LåŒºé–“ã®ã‚ºãƒ¬è€æ€§  
  \[
  Î”o_{pace} = Î± \cdot sim + Î² \cdot \exp\left(-\frac{d^2}{2Ïƒ^2}\right)
  \]  
  - `sim`ï¼šç†æƒ³ãƒ©ãƒƒãƒ—ã¨ã‚³ãƒ¼ã‚¹æ¨™æº–ãƒ©ãƒƒãƒ—ã®é¡ä¼¼åº¦  
  - `Ïƒ`ï¼šã‚ºãƒ¬è€æ€§

---

## ğŸ† æœ€çµ‚ã‚¹ã‚³ã‚¢
\[
ICPScore = BasePower \times OutputRate
\]

- **å‹ç‡ï¼ˆSoftmaxï¼‰**  
\[
WinProb_i = \frac{e^{ICPScore_i}}{\sum_j e^{ICPScore_j}}
\]

- **æç›Šåˆ†å²ã‚ªãƒƒã‚º**  
\[
Odds_i = \frac{1}{WinProb_i}
\]

---

## ğŸ“‚ å‡ºåŠ›å½¢å¼ï¼ˆTARGETäº’æ›CSVï¼‰
- æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼šShift-JIS
- åˆ—ï¼šæ , é¦¬ç•ª, é¦¬å, ICPã‚¹ã‚³ã‚¢, æç›Šåˆ†å²ã‚ªãƒƒã‚º

ä¾‹ï¼š
```csv
æ ,é¦¬ç•ª,é¦¬å,ICPã‚¹ã‚³ã‚¢,æç›Šåˆ†å²ã‚ªãƒƒã‚º
3,5,ã‚µãƒ³ãƒ—ãƒ«ãƒ›ãƒ¼ã‚¹,112.3,3.5
6,11,ãƒ†ã‚¹ãƒˆãƒ›ãƒ¼ã‚¹,105.7,5.8
ã‚ã‹ã£ãŸã€‚ã“ã“ã§**â€œå®Œå…¨æº–å‚™â€ã‚’ã‚¼ãƒ­ã‹ã‚‰é †ç•ªã«ã‚„ã‚Šã¾ã™ã€‚
å„ã‚¹ãƒ†ãƒƒãƒ—ã«ãƒã‚§ãƒƒã‚¯æ–¹æ³•**ã‚’ä»˜ã‘ã‚‹ã®ã§ã€1ã¤ãšã¤é€²ã‚ã¦ã­ã€‚è¿·å­ã«ãªã£ãŸã‚‰ã€ãã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã€Œãƒã‚§ãƒƒã‚¯ã€ã ã‘è¦‹ã‚Œã°OKã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—1ï½œã„ã¾é–‹ã„ã¦ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‰ã˜ã‚‹ï¼ˆè¡çªé˜²æ­¢ï¼‰
	â€¢	Excelãƒ»ãƒ¡ãƒ¢å¸³ãƒ»Pythonã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹ï¼ˆCSVãŒé–‹ã„ãŸã¾ã¾ã ã¨ã€æ›´æ–°ã«å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

ãƒã‚§ãƒƒã‚¯ï¼šä½•ã‚‚é–‹ã„ã¦ã„ãªã„ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—2ï½œãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’å›ºå®šã™ã‚‹ï¼ˆè¿·å­é˜²æ­¢ï¼‰

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã§ D:\ ã‚’é–‹ãã€ä»¥ä¸‹ã‚’ä½œã‚Šã¾ã™ï¼ˆã‚ã‚Œã°ãã®ã¾ã¾ã§OKï¼‰ã€‚

D:\IC-App\
 â”œâ”€ config\
 â”œâ”€ icp\
 â”œâ”€ runs\
 â”‚   â”œâ”€ sample\
 â”‚   â”œâ”€ _sanitized\
 â”‚   â””â”€ _logs\
 â””â”€ scripts\

ãƒã‚§ãƒƒã‚¯ï¼šä¸Šã®6ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ãˆã‚‹ã€‚runs\_sanitized ã¨ _logs ãŒã‚ã‚‹ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—3ï½œã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œã®â€œå®ˆè¡›â€ã‚’ç½®ãï¼ˆè¦æ ¼ã‚ºãƒ¬ã®è‡ªå‹•ä¿®æ­£ï¼‰

ã“ã®3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’â€œä¸¸ã”ã¨â€è²¼ã‚Šæ›¿ãˆã¾ã™ã€‚è²¼ã‚Šæ›¿ãˆãŸã‚‰ä¿å­˜ã€‚

3-1) D:\IC-App\scripts\run_icp.batï¼ˆå…¨ç½®æ›ï¼‰

ã©ã®ãƒãƒƒãƒã‚’å®Ÿè¡Œä¸­ã‹ã€è‡ªåˆ†ã®ãƒ‘ã‚¹ã‚’æœ€ä¸Šæ®µã«å‡ºã™ï¼å…¥åŠ›ã‚’ã‚¬ãƒ¼ãƒ‰ã§æ­£è¦åŒ–ã—ã¦ã‹ã‚‰è¨ˆç®—ï¼ãƒ­ã‚°ä¿å­˜ï¼SJISå‡ºåŠ›ã€‚

@echo off
setlocal ENABLEDELAYEDEXPANSION
title IC-App (Guarded Run)

REM ==== SELF CHECK ====
echo BAT    : "%~f0"

REM ==== ROOT & PY ====
set "ROOT=D:\IC-App"
set "PY=python"
where %PY% >nul 2>nul || set "PY=py"
where %PY% >nul 2>nul || (
  echo [NG] Python not found. Install Python and retry.
  pause & exit /b 1
)

REM ==== FOLDERS ====
if not exist "%ROOT%\runs" mkdir "%ROOT%\runs"
if not exist "%ROOT%\runs\sample" mkdir "%ROOT%\runs\sample"
if not exist "%ROOT%\runs\_sanitized" mkdir "%ROOT%\runs\_sanitized"
if not exist "%ROOT%\runs\_logs" mkdir "%ROOT%\runs\_logs"

REM ==== TIMESTAMP ====
for /f %%t in ('powershell -NoProfile -Command "Get-Date -Format yyyyMMdd_HHmmss"') do set TS=%%t

REM ==== INPUT (raw) ====
set "RAW_IN=%ROOT%\runs\sample\race_input.csv"
if not exist "%RAW_IN%" if exist "%ROOT%\runs\sample\race_input.txt" set "RAW_IN=%ROOT%\runs\sample\race_input.txt"
if not exist "%RAW_IN%" (
  echo [INFO] create sample: %ROOT%\runs\sample\race_input.csv
  powershell -NoProfile -Command ^
    "$p='%ROOT%\runs\sample\race_input.csv';" ^
    "$c=@'umaban,umaname,odds,speed_rating,class_rating,margin_rating,distance_fit,pace_fit
1,ã‚¢ãƒ«ãƒ•ã‚¡,3.1,97,0.95,0.10,1.10,1.05
2,ãƒ–ãƒ©ãƒœãƒ¼,8.6,100,0.90,0.00,0.98,0.95
3,ãƒãƒ£ãƒ¼ãƒªãƒ¼,4.9,95,1.00,0.15,1.05,1.02'@;" ^
    "Set-Content -Path $p -Value $c -Encoding utf8BOM"
)

REM ==== LOG ====
set "LOGFILE=%ROOT%\runs\_logs\run_%TS%.log"

REM ==== GUARD ====
echo [RUN] Guard input: "%RAW_IN%" > "%LOGFILE%"
"%PY%" "%ROOT%\scripts\icp_guard.py" --in "%RAW_IN%" --outdir "%ROOT%\runs\_sanitized" --contract "%ROOT%\config\io_contract.yaml" >> "%LOGFILE%" 2>&1
if errorlevel 1 (
  echo [NG] Guard failed. Opening log...
  start notepad.exe "%LOGFILE%"
  pause & exit /b 1
)
set "SAN_TXT=%ROOT%\runs\_sanitized\last_sanitized.txt"
if not exist "%SAN_TXT%" (
  echo [NG] Guard did not produce pointer file: "%SAN_TXT%"
  start notepad.exe "%LOGFILE%"
  pause & exit /b 1
)
set /p INCSV=<"%SAN_TXT%"

REM ==== OUTPUT ====
set "OUTCSV=%ROOT%\runs\sample\race_icp_%TS%_sjis.csv"

REM ==== SHOW PLAN ====
echo ROOT   : "%ROOT%"
echo PYTHON : "%PY%"
echo RAW_IN : "%RAW_IN%"
echo IN     : "%INCSV%"
echo OUT    : "%OUTCSV%"
echo SCRIPT : "%ROOT%\scripts\recalc_icp.py"
echo LOG    : "%LOGFILE%"

REM ==== RUN ====
"%PY%" "%ROOT%\scripts\recalc_icp.py" --race_csv "%INCSV%" --out_csv "%OUTCSV%" >> "%LOGFILE%" 2>&1
if errorlevel 1 (
  echo [NG] Python failed. See log.
  start notepad.exe "%LOGFILE%"
  pause & exit /b 1
)

REM ==== VERIFY ====
if not exist "%OUTCSV%" (
  echo [NG] Output not found: "%OUTCSV%"
  start notepad.exe "%LOGFILE%"
  pause & exit /b 1
)
for %%I in ("%OUTCSV%") do set SZ=%%~zI
if "!SZ!"=="0" (
  echo [NG] Output is zero bytes: "%OUTCSV%"
  start notepad.exe "%LOGFILE%"
  pause & exit /b 1
)

echo [OK] Done. File created: "%OUTCSV%"
powershell -NoProfile -Command "Get-Content -Path '%OUTCSV%' -TotalCount 2 | ForEach-Object { Write-Output ('[HEAD] ' + $_) }"
start "" "%ROOT%\runs\sample"
echo (Log saved) %LOGFILE%
pause
endlocal

3-2) D:\IC-App\scripts\icp_guard.pyï¼ˆæ–°è¦ãƒ»å…¨è²¼ã‚Šï¼‰

å…¥åŠ›ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰/åŒºåˆ‡ã‚Š/åˆ—åã‚†ã‚Œã‚’è‡ªå‹•ã§æ­£è¦åŒ–ã—ã€å®‰å…¨ãªä¸­é–“CSVï¼ˆUTF-8+BOM, ã‚«ãƒ³ãƒï¼‰ã‚’ä½œã‚Šã¾ã™ã€‚

# -*- coding: utf-8 -*-
from __future__ import annotations
"""
icp_guard.py
- å…¥åŠ›CSV/TXTã‚’ã€Œèª­ã‚€â†’æ¤œè¨¼â†’æ­£è¦åŒ–â†’ä¸­é–“CSVã¸ã€ã™ã‚‹å®ˆè¡›ã€‚
- æ–‡å­—ã‚³ãƒ¼ãƒ‰: utf-8-sig/utf-8/utf-16(le/be)/cp932 ã‚’è‡ªå‹•åˆ¤å®šï¼ˆä¾å­˜ç„¡ã—ï¼‰
- åŒºåˆ‡ã‚Š   : ã‚«ãƒ³ãƒ/ã‚¿ãƒ– è‡ªå‹•åˆ¤å®š â†’ ã‚«ãƒ³ãƒã«çµ±ä¸€
- åˆ—å     : io_contract.yaml ã®åŒç¾©èªã‚’æ­£æº–åã¸
- å¿…é ˆåˆ—   : æ¬ ã‘ã‚Œã°å³ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ­ã‚°ã«ä¸è¶³åã‚’æ˜è¨˜ï¼‰
- å‡ºåŠ›     : UTF-8(BOM) ã®ã‚«ãƒ³ãƒCSVã€‚ãƒ‘ã‚¹ã‚’ last_sanitized.txt ã«æ›¸å‡º
"""
import os, sys, argparse, datetime
import pandas as pd

def sniff_encoding(path: str) -> str:
    with open(path, 'rb') as f:
        head = f.read(4)
    if head.startswith(b'\xef\xbb\xbf'): return 'utf-8-sig'
    if head.startswith(b'\xff\xfe'):     return 'utf-16'
    if head.startswith(b'\xfe\xff'):     return 'utf-16'
    try:
        with open(path, 'r', encoding='utf-8') as _:
            return 'utf-8'
    except Exception:
        try:
            with open(path, 'r', encoding='cp932') as _:
                return 'cp932'
        except Exception:
            return 'utf-8'

def sniff_sep(path: str, enc: str) -> str:
    try:
        with open(path, 'r', encoding=enc, errors='ignore') as f:
            head = ''.join([next(f) for _ in range(3)])
        return '\t' if head.count('\t') >= head.count(',') else ','
    except Exception:
        return ','

def load_contract(path: str) -> dict:
    import yaml
    if not os.path.exists(path):
        return {
            "required": ["umaban","umaname","odds"],
            "numeric":  ["umaban","odds","speed_rating","class_rating","margin_rating","distance_fit","pace_fit","track_bias","draw_bias","weight_adj","inside_eff","front_eff"],
            "aliases": {
              "umaban":   ["æ ç•ª","é¦¬ç•ª","ç•ªå·","uma_no","uma_num"],
              "umaname":  ["é¦¬å","name","horse_name","uma_name"],
              "odds":     ["å˜å‹","odds_win","o"]
            }
        }
    with open(path, 'r', encoding='utf-8') as f:
        import yaml
        return yaml.safe_load(f)

def normalize_columns(cols, aliases):
    norm = []
    for c in cols:
        c0 = str(c).strip()
        lc = c0.lower()
        hit = None
        for k, syn in aliases.items():
            if lc == k.lower() or lc in [s.lower() for s in syn]:
                hit = k; break
        norm.append(hit if hit else lc)
    return norm

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--in", dest="inp", required=True)
    ap.add_argument("--outdir", required=True)
    ap.add_argument("--contract", required=True)
    a = ap.parse_args()

    enc = sniff_encoding(a.inp)
    sep = sniff_sep(a.inp, enc)
    try:
        df = pd.read_csv(a.inp, encoding=enc, sep=sep, engine="python")
    except Exception as e:
        print(f"[GUARD][ERROR] read failed: enc={enc} sep={'TAB' if sep=='\\t' else 'COMMA'} path={a.inp}")
        print(repr(e)); sys.exit(1)

    contract = load_contract(a.contract)
    required = [c.lower() for c in contract.get("required", [])]
    numeric  = [c.lower() for c in contract.get("numeric", [])]
    aliases  = contract.get("aliases", {})

    df.columns = normalize_columns(df.columns, aliases)
    missing = [r for r in required if r not in df.columns]
    if missing:
        print(f"[GUARD][ERROR] missing required columns: {missing}")
        print(f"[GUARD][INFO] columns found: {list(df.columns)}")
        sys.exit(2)

    for c in numeric:
        if c in df.columns:
            df[c] = pd.to_numeric(df[c], errors="coerce")

    if len(df) == 0:
        print("[GUARD][ERROR] input has 0 rows"); sys.exit(3)

    os.makedirs(a.outdir, exist_ok=True)
    ts = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    out_path = os.path.join(a.outdir, f"race_input_%s_sanitized.csv" % ts)
    df.to_csv(out_path, index=False, encoding="utf-8-sig")

    with open(os.path.join(a.outdir, "last_sanitized.txt"), "w", encoding="utf-8") as f:
        f.write(out_path)

    print(f"[GUARD][OK] enc={enc} sep={'TAB' if sep=='\\t' else 'COMMA'} -> {out_path}")

if __name__ == "__main__":
    main()

3-3) D:\IC-App\config\io_contract.yamlï¼ˆæ–°è¦ãƒ»å…¨è²¼ã‚Šï¼‰

å¿…é ˆåˆ—ãƒ»æ•°å€¤åˆ—ãƒ»åŒç¾©èªãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆåˆ—åã‚†ã‚Œã®å¸åï¼‰ã‚’å®šç¾©ã€‚

required:
  - umaban
  - umaname
  - odds

numeric:
  - umaban
  - odds
  - speed_rating
  - class_rating
  - margin_rating
  - distance_fit
  - pace_fit
  - track_bias
  - draw_bias
  - weight_adj
  - inside_eff
  - front_eff

aliases:
  umaban:   ["æ ç•ª","é¦¬ç•ª","ç•ªå·","uma_no","uma_num"]
  umaname:  ["é¦¬å","name","horse_name","uma_name"]
  odds:     ["å˜å‹","odds_win","o"]

  speed_rating:  ["speed","spd","speed_index"]
  class_rating:  ["class","cls","class_index"]
  margin_rating: ["margin","mg","margin_sec"]
  distance_fit:  ["dist_fit","dfit"]
  pace_fit:      ["pacefit","pfit"]
  track_bias:    ["t_bias","tbias"]
  draw_bias:     ["d_bias","dbias","frame_bias"]
  weight_adj:    ["w_adj","weightadj"]

  inside_eff:    ["inside_bias","inside_today","in_eff"]
  front_eff:     ["front_bias","front_today","fr_eff"]

ãƒã‚§ãƒƒã‚¯ï¼š
	â€¢	scripts\run_icp.bat ã‚’é–‹ãã€1è¡Œç›®ã« IC-App (Guarded Run)ã€å†’é ­ã« echo BAT : "%~f0" ãŒã‚ã‚‹ã€‚
	â€¢	scripts\icp_guard.py ãŒã‚ã‚‹ã€‚
	â€¢	config\io_contract.yaml ãŒã‚ã‚‹ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—4ï½œã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ä¸€å¼ã‚’æœ€æ–°ã«ï¼ˆå·®ã—æ›¿ãˆæ¸ˆã¿ãªã‚‰ãã®ã¾ã¾ï¼‰

ä»¥ä¸‹ãŒã™ã§ã«å‹•ã„ã¦ã„ã‚‹æœ€æ–°ãªã‚‰è§¦ã‚‰ãªãã¦OKã€‚ã‚‚ã—å¤ã„ã‹ä¸æ˜ãªã‚‰ã€å‰å›æ¸¡ã—ãŸå·®ã—æ›¿ãˆç‰ˆã‚’ä¸¸ã”ã¨ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚
	â€¢	D:\IC-App\scripts\recalc_icp.pyï¼ˆå…ˆé ­ã« sys.path.insert(0, ROOT) ãŒã‚ã‚‹ã“ã¨ï¼å‡ºåŠ›ã¯ cp932ï¼‰
	â€¢	D:\IC-App\icp\base_power.pyï¼ˆãƒ¬ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«è£œæ­£ Î»Ã—(Top3å¹³å‡âˆ’100) ã‚’å®Ÿè£…æ¸ˆã¿ï¼‰
	â€¢	D:\IC-App\icp\output_rate.pyï¼ˆç›¸äº’ä½œç”¨ packÃ—slow, stringÃ—fastã€å½“æ—¥åŠ¹ãã‚’åˆæˆï¼‰
	â€¢	D:\IC-App\icp\icp_core.pyï¼ˆICPâ†’p_winâ†’BE/EVã€äººæ°—å¸¯æ ¡æ­£ï¼†buy_flagï¼‰

ã‚¯ã‚¤ãƒƒã‚¯ç¢ºèªï¼ˆå¿…ãšã‚ã‚‹ã¹ãè¡Œï¼‰ï¼š
	â€¢	recalc_icp.pyï¼š
	â€¢	sys.path.insert(0, ROOT)
	â€¢	out.to_csv(... encoding="cp932"
	â€¢	icp_core.pyï¼š
	â€¢	out["RaceLevel"] = race_level
	â€¢	out["EV"] = EV ã¨ out["buy_flag"] = (out["ICP_rank"] <= 3) & buy_flag

ãƒã‚§ãƒƒã‚¯ï¼šä¸Šã®â€œã‚ã‚‹ã¹ãè¡Œâ€ãŒãƒ•ã‚¡ã‚¤ãƒ«å†…ã«ã‚ã‚‹ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—5ï½œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆconfig.yamlï¼‰ã‚’ç½®ã

D:\IC-App\config\config.yaml ã‚’ã€å‰ã«æ¸¡ã—ãŸå­¦ç¿’ãƒ»é‹ç”¨ç”¨ã®å†…å®¹ã§ä¿å­˜ï¼ˆæ¸©åº¦ã‚„é‡ã¿ï¼‰ã€‚
â€» è¿·ã£ãŸã‚‰ã€ãã®ã¾ã¾ã§OKã€‚å¾Œã‹ã‚‰DLã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚

ãƒã‚§ãƒƒã‚¯ï¼šconfig.yaml ãŒå­˜åœ¨ã™ã‚‹ï¼ˆç„¡ãã¦ã‚‚ recalc_icp.py ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ãã¾ã™ï¼‰ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—6ï½œåˆå›ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆè‡ªå‹•ã‚µãƒ³ãƒ—ãƒ«ã§OKï¼‰
	1.	ä½•ã‚‚ç½®ã„ã¦ã„ãªã„çŠ¶æ…‹ã§ã€D:\IC-App\scripts\run_icp.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã€‚
	2.	é»’ç”»é¢ã®æœ€ä¸Šæ®µã« BAT : "D:\IC-App\scripts\run_icp.bat" ã¨å‡ºã‚‹ã€‚
	3.	é€”ä¸­ã« RAW_IN ã‚„ INã€OUTã€LOG ã®ãƒ‘ã‚¹ãŒå‡ºã‚‹ã€‚
	4.	æœ€å¾Œã«
	â€¢	[OK] Done. File created: "â€¦race_icp_<æ™‚åˆ»>_sjis.csv"
	â€¢	[HEAD] umaban,umaname,odds,...,BE_odds
	â€¢	[HEAD] 1,ã‚¢ãƒ«ãƒ•ã‚¡,3.1,...
ãŒè¡¨ç¤ºã•ã‚Œã€runs\sample\ ãƒ•ã‚©ãƒ«ãƒ€ãŒé–‹ãã€‚

ãƒã‚§ãƒƒã‚¯ï¼š
	â€¢	runs\sample\race_icp_ï¼œä»Šã®æ™‚åˆ»ï¼_sjis.csv ãŒã§ãã¦ã„ã‚‹ã€‚
	â€¢	Excelã§é–‹ãã¨é¦¬åãŒæ­£ã—ãæ—¥æœ¬èªè¡¨ç¤ºã€‚
	â€¢	runs\_logs\run_ï¼œæ™‚åˆ»ï¼.log ãŒã‚ã‚‹ã€‚

â¸»

ã‚¹ãƒ†ãƒƒãƒ—7ï½œã‚ãªãŸã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ
	1.	D:\IC-App\runs\sample\race_input.csv ã‚’ä¸Šæ›¸ãï¼ˆãƒ˜ãƒƒãƒ€åã¯æ—¥æœ¬èªã§ã‚‚OKã€‚ã‚¬ãƒ¼ãƒ‰ãŒç›´ã—ã¾ã™ï¼‰ã€‚
	2.	ã‚‚ã†ä¸€åº¦ run_icp.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã€‚
	3.	æ–°ã—ã„æ™‚åˆ»ã®CSVãŒå‡ºã‚‹ â†’ Excelã§ç¢ºèªã€‚

ãƒã‚§ãƒƒã‚¯ï¼š
	â€¢	ICP_rank ãŒ 1,2,3 ã¨ä¸¦ã¶ã€‚
	â€¢	p_win ã®åˆè¨ˆ â‰ˆ 1.0ã€‚
	â€¢	BE_odds = (1 - 0.20) / p_win ã®é–¢ä¿‚ãŒåˆã†ã€‚
	â€¢	buy_flag ãŒTRUEã®é¦¬ãŒã„ã‚‹ã‹ï¼ˆTop3ï¼†EVé–¾å€¤ã‚¯ãƒªã‚¢ï¼‰ã€‚

â¸»

ãƒˆãƒ©ãƒ–ãƒ«æ—©è¦‹è¡¨ï¼ˆã“ã“ã ã‘è¦‹ã‚Œã°ç›´ã›ã‚‹ï¼‰
	â€¢	å¤ã„batã‚’å®Ÿè¡Œã—ã¦ã„ãŸ
â†’ ç”»é¢ã®æœ€ä¸Šæ®µ BAT : â€œâ€¦â€ ã‚’è¦‹ã‚‹ã€‚D:\IC-App\scripts\run_icp.bat ã˜ã‚ƒãªã‘ã‚Œã°ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã€‚
	â€¢	[GUARD][ERROR] missing required columns
â†’ å…¥åŠ›ãƒ˜ãƒƒãƒ€ãŒä¸è¶³ã€‚io_contract.yaml ã® aliases ã«ã‚ã‚‹åŒç¾©èªã«åˆã‚ã›ã‚‹ã‹ã€åˆ—ã‚’è¿½åŠ ã€‚
ï¼ˆæœ€ä½é™ï¼šumaban, umaname, oddsï¼‰
	â€¢	[NG] Output is zero bytes / CSVä¸­èº«ãŒã€Œ[OK] Done -ã€
â†’ æ—§ãƒãƒƒãƒã®ä¸å…·åˆã€‚ä»Šå›ã® run_icp.bat ã«å¿…ãšç½®æ›ã™ã‚Œã°è§£æ±ºã€‚
	â€¢	ModuleNotFoundError: icp
â†’ recalc_icp.py å…ˆé ­ã«
sys.path.insert(0, ROOT) ãŒã‚ã‚‹ã‹ç¢ºèªã€‚
	â€¢	æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘
â†’ å‡ºåŠ›ã¯ cp932 å›ºå®šã€‚Excelã§ã€Œãƒ‡ãƒ¼ã‚¿â†’ãƒ†ã‚­ã‚¹ãƒˆ/CSVã‹ã‚‰ã€ã§ã¯ãªãã€æ™®é€šã«ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§é–‹ãã€‚
	â€¢	Python not found
â†’ ã™ã§ã«å‹•ã„ã¦ã„ã‚‹ãªã‚‰ä¸è¦ã€‚ã‚‚ã—å‡ºãŸã‚‰ã€Pythonã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«å†å®Ÿè¡Œã€‚

â¸»

ã“ã“ã¾ã§ã§ããŸã‚‰ â€œå®Œå…¨æº–å‚™ å®Œäº†â€
	â€¢	ä»¥å¾Œã¯ race_input.csv ã‚’ç½®ã â†’ run_icp.bat ã‚¯ãƒªãƒƒã‚¯ã ã‘ã€‚
	â€¢	å…¥åŠ›ã®è¦æ ¼ã‚ºãƒ¬ãƒ»æ–‡å­—åŒ–ã‘ãƒ»å¤ã„batèª¤å®Ÿè¡Œãƒ»ç©ºå‡ºåŠ›ã¯å®ˆè¡›ãŒã™ã¹ã¦é˜²æ­¢ã—ã¾ã™ã€‚

ã“ã®æ‰‹é †ã§é€²ã‚ã¦ã€ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å¼•ã£ã‹ã‹ã£ãŸã‹ã ã‘æ•™ãˆã¦ãã‚Œã‚Œã°ã€ãã“ã‚’ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã§ç›´ã™ã‚ˆã€‚